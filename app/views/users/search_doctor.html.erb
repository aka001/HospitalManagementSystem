<%= form_tag({:action => 'search_perform_function'}) do %>
	<table>
		<tr>
		<td><%= label_tag(:Attribute) %></td>
		<td><%= select_tag(:name, options_for_select([['name', 'name'],
														['qualification', 'qualification'],
														['education', 'education'],
														['specialised_fields', 'specialised_fields'],
														['salary', 'salary']])) %></td>>
		<th><%= label_tag(:query) %></th>
		<th><%= text_field_tag(:query)%></th>
	</table>
	<%= submit_tag("Find Doctor")%>
<% end %>
<% if @doctors != nil %>
		<table>
			<thead>
				<th>Username</th>
				<th>Name</th>
				<th>Gender</th>
				<th>Date_of_birth</th>
				<th>Address</th>
				<th>Qualification</th>
				<th>Status</th>
			</thead>
			
				<% @doctors.each do |doc| %>
				<tr>
					<% doctor=Doctor.find(doc['id']) %>
					<% user= doctor.users %>
					<% if !(user.empty?) %>
						<% user=user.first %>
						<td><%= user.username%></td>
					<% end %>
					<td><%= doctor.name %></td>
					<td><%= doctor.gender %></td>
					<td><%= doctor.date_of_birth %></td>
					<td><%= doctor.address %></td>
					<td><%= doctor.qualification %></td>
					<td><%= doctor.id %></td>
					<% x=Appointment.where(doctor_id: doctor.id, patient_id: @patient.id) %>
					<% if x.empty? %>
						<td><%= link_to("Request", {:action => 'request_appointment', :id1 => user.id, :id2 => session[:user_id]}, :class => "back-link") %></td>	
					<% else %>
						<% flag=1 %>
						<% x.each do |xit| %>
							<% if xit.status == 'pending' %>
								<% flag=0 %>
								<% break %>
							<% end %>
						<% end %>
						<% if flag==0 %>
							<% x=x.first %>
							<td><%= x.status %></td>
						<% else %>
							<td><%= link_to("Request", {:action => 'request_appointment', :id1 => user.id, :id2 => session[:user_id]}, :class => "back-link") %></td>
						<% end %>
					<% end %>
					
				</tr>
				<% end %>
		</table>
	<% else %>
		<h2>No records yet</h2>
	<% end %>

